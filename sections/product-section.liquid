{% comment %}
=== SEZIONE PRODOTTO PERSONALIZZATA ===
File: sections/product-section.liquid

INSTALLAZIONE:
1. Admin Shopify > Temi > Modifica codice
2. Sections > Aggiungi nuova sezione
3. Nome: product-section
4. Incolla questo codice
5. Salva
6. Theme editor > Aggiungi sezione "Produkt Sektion"
{% endcomment %}

{{ 'category-sidebar.css' | asset_url | stylesheet_tag }}

<style>
  .product-with-sidebar-wrapper {
    display: flex;
    gap: 30px;
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
  }
  .product-sidebar-container {
    flex: 0 0 280px;
    position: sticky;
    top: 100px;
    height: fit-content;
    max-height: calc(100vh - 120px);
    overflow-y: auto;
  }
  .product-main-container {
    flex: 1;
    min-width: 0;
  }
  @media screen and (max-width: 992px) {
    .product-with-sidebar-wrapper {
      flex-direction: column;
    }
    .product-sidebar-container {
      display: none;
    }
  }
  .product-sidebar-mobile-toggle {
    display: none;
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #C12624, #A01F1D);
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(193, 38, 36, 0.4);
    z-index: 998;
  }
  @media screen and (max-width: 992px) {
    .product-sidebar-mobile-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .product-sidebar-container.mobile-open {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      width: 85%;
      max-width: 320px;
      height: 100vh;
      background: white;
      z-index: 1000;
      box-shadow: 5px 0 20px rgba(0,0,0,0.2);
    }
  }
</style>

<div class="product-with-sidebar-wrapper">
  <!-- Sidebar Categorie -->
  <div class="product-sidebar-container" id="productSidebar">
    {% render 'category-sidebar', current_collection: product.collections.first.handle %}
  </div>

  <!-- Contenuto Prodotto -->
  <div class="product-main-container">
    <section class="product-section" data-section="{{ section.id }}">
      <div class="product-container">

        <!-- Breadcrumb -->
        {% if section.settings.show_breadcrumb %}
        <nav class="breadcrumb">
          <a href="{{ routes.root_url }}">Startseite</a>
          <span>›</span>
          <a href="https://pflegeteufel.de/collections">Alle Produkte</a>
          <span>›</span>
          <span>{{ product.title }}</span>
        </nav>
        {% endif %}

        <div class="product-grid">
      
      <!-- SEZIONE IMMAGINI -->
      <div class="product-images">
        
        <!-- Badge sconto -->
        {% if product.compare_at_price > product.price %}
          {% assign discount = product.compare_at_price | minus: product.price %}
          {% assign percentage = discount | times: 100 | divided_by: product.compare_at_price %}
          <div class="discount-badge">-{{ percentage }}% RABATT</div>
        {% endif %}

        <!-- Immagine principale -->
        <div class="main-image-wrapper">
          {% if product.featured_media %}
            <img 
              src="{{ product.featured_media | image_url: width: 800 }}" 
              alt="{{ product.title }}"
              class="main-image"
              id="MainImage"
              width="800"
              height="800"
              loading="lazy"
            >
          {% else %}
            {{ 'product-1' | placeholder_svg_tag: 'main-image' }}
          {% endif %}
        </div>

        <!-- Galleria thumbnails -->
        {% if product.media.size > 1 %}
        <div class="thumbnails">
          {% for media in product.media limit: 6 %}
            <div class="thumb {% if forloop.first %}active{% endif %}" 
                 onclick="changeMainImage('{{ media | image_url: width: 800 }}', this)">
              <img 
                src="{{ media | image_url: width: 120 }}" 
                alt="{{ product.title }}"
                width="120"
                height="120"
                loading="lazy"
              >
            </div>
          {% endfor %}
        </div>
        {% endif %}

      </div>

      <!-- SEZIONE INFO -->
      <div class="product-info">
        
        <!-- Vendor -->
        {% if product.vendor != blank %}
          <div class="vendor">{{ product.vendor }}</div>
        {% endif %}

        <!-- Titolo -->
        <h1 class="product-title">{{ product.title }}</h1>

        <!-- Rating stelle -->
        <div class="rating">
          <div class="stars">
            <span class="star">★</span>
            <span class="star">★</span>
            <span class="star">★</span>
            <span class="star">★</span>
            <span class="star">★</span>
          </div>
        </div>

        <!-- Prezzo -->
        <div class="price-wrapper">
          <span class="current-price">{{ product.selected_or_first_available_variant.price | money }}</span>
          {% if product.selected_or_first_available_variant.compare_at_price > product.selected_or_first_available_variant.price %}
            <span class="original-price">{{ product.selected_or_first_available_variant.compare_at_price | money }}</span>
            {% assign save = product.selected_or_first_available_variant.compare_at_price | minus: product.selected_or_first_available_variant.price %}
            <span class="save-amount">Sparen Sie {{ save | money }}</span>
          {% endif %}
        </div>

        <!-- Form acquisto -->
        {% form 'product', product, id: 'product-form' %}
          
          <!-- Varianti -->
          {% unless product.has_only_default_variant %}
          <div class="variants">
            {% for option in product.options_with_values %}
            <div class="variant-option">
              <label>{{ option.name }}:</label>
              <select name="options[{{ option.name }}]" class="variant-select">
                {% for value in option.values %}
                  <option value="{{ value }}" {% if forloop.first %}selected{% endif %}>
                    {{ value }}
                  </option>
                {% endfor %}
              </select>
            </div>
            {% endfor %}
          </div>
          {% endunless %}

          <!-- Quantità -->
          <div class="quantity-section">
            <label>Anzahl:</label>
            <div class="qty-controls">
              <button type="button" class="qty-btn" onclick="updateQty(-1)">−</button>
              <input type="number" name="quantity" value="1" min="1" class="qty-input" id="Quantity">
              <button type="button" class="qty-btn" onclick="updateQty(1)">+</button>
            </div>
          </div>

          <!-- Bottone acquisto -->
          <button 
            type="submit" 
            class="add-to-cart-btn"
            {% unless product.available %}disabled{% endunless %}>
            {% if product.available %}
              In den Warenkorb
            {% else %}
              Ausverkauft
            {% endif %}
          </button>

          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" id="ProductSelect">
          
        {% endform %}

      </div>
    </div>

    <!-- Descrizione orizzontale sotto entrambe le sezioni -->
    {% if product.description != blank %}
    <div class="description-horizontal">
      <div class="description-content">
        <h3>Produktbeschreibung</h3>
        {{ product.description }}
      </div>
    </div>
    {% endif %}

      </div>
    </section>
  </div><!-- .product-main-container -->
</div><!-- .product-with-sidebar-wrapper -->

<!-- Mobile toggle button -->
<button class="product-sidebar-mobile-toggle" onclick="toggleProductSidebar()" aria-label="Kategorien anzeigen">
  ☰
</button>

<script>
function toggleProductSidebar() {
  var sidebar = document.getElementById('productSidebar');
  if (sidebar) {
    sidebar.classList.toggle('mobile-open');
  }
}
</script>

<style>
.product-section {
  background: #F8F8F8;
  padding: 0;
  margin: 0;
  width: 100vw;
  position: relative;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.product-container {
  max-width: 100%;
  margin: 0;
  padding: 40px 0;
}

/* Breadcrumb */
.breadcrumb {
  margin-bottom: 30px;
  font-size: 14px;
  color: #666;
  padding: 0 20px;
  max-width: 1200px;
  margin-left: auto;
  margin-right: auto;
}

.breadcrumb a {
  color: #C12624;
  text-decoration: none;
}

.breadcrumb span {
  margin: 0 8px;
  color: #999;
}

/* Grid Layout */
.product-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0;
  background: white;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  border-radius: 16px;
  overflow: hidden;
  max-width: 1200px;
  margin: 0 auto 40px auto;
  margin-left: auto;
  margin-right: auto;
}

/* SEZIONE IMMAGINI */
.product-images {
  position: relative;
  background: #f8f9fa;
  padding: 60px 40px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
}

.discount-badge {
  position: absolute;
  top: 20px;
  right: 20px;
  background: linear-gradient(45deg, #C12624, #A01F1D);
  color: white;
  padding: 8px 16px;
  border-radius: 25px;
  font-size: 14px;
  font-weight: bold;
  z-index: 10;
}

.main-image-wrapper {
  width: 100%;
  max-width: 500px;
  aspect-ratio: 1;
  border-radius: 20px;
  overflow: hidden;
  border: 3px solid #C12624;
  margin-bottom: 20px;
  transition: transform 0.3s ease;
  box-shadow: 0 8px 30px rgba(193, 38, 36, 0.15);
}

.main-image-wrapper:hover {
  transform: scale(1.02);
  box-shadow: 0 12px 40px rgba(193, 38, 36, 0.25);
}

.main-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  cursor: zoom-in;
  transition: transform 0.3s ease;
}

.main-image-wrapper:hover .main-image {
  transform: scale(1.05);
}

.thumbnails {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: center;
}

.thumb {
  width: 80px;
  height: 80px;
  border: 2px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
  transition: all 0.3s ease;
}

.thumb.active,
.thumb:hover {
  border-color: #C12624;
  transform: scale(1.05);
}

.thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* SEZIONE INFO */
.product-info {
  padding: 60px 40px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  min-height: 100vh;
}

.vendor {
  color: #C12624;
  font-size: 14px;
  font-weight: 600;
  text-transform: uppercase;
  margin-bottom: 10px;
  letter-spacing: 0.5px;
}

.product-title {
  font-size: 32px;
  font-weight: 700;
  color: #2c3e50;
  margin-bottom: 20px;
  line-height: 1.2;
}

/* Rating */
.rating {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 20px;
}

.stars {
  display: flex;
  gap: 2px;
}

.star {
  color: #ffc107;
  font-size: 20px;
  transition: transform 0.2s ease;
}

.star:hover {
  transform: scale(1.2);
}

.rating-count {
  color: #666;
  font-size: 14px;
}

/* Prezzo */
.price-wrapper {
  margin-bottom: 25px;
}

.current-price {
  font-size: 36px;
  font-weight: 700;
  color: #C12624;
  margin-right: 15px;
}

.original-price {
  font-size: 24px;
  color: #999;
  text-decoration: line-through;
  margin-right: 10px;
}

.save-amount {
  background: #28a745;
  color: white;
  padding: 4px 12px;
  border-radius: 15px;
  font-size: 12px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

/* Descrizione */
.description {
  margin-bottom: 30px;
}

.description h3 {
  font-size: 18px;
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 15px;
  border-bottom: 2px solid #C12624;
  padding-bottom: 8px;
  display: inline-block;
}

.description p {
  color: #555;
  line-height: 1.6;
  margin-bottom: 15px;
}

.description ul {
  color: #555;
  padding-left: 20px;
}

.description li {
  margin-bottom: 8px;
}

.description li::marker {
  color: #C12624;
}

/* Varianti */
.variants {
  margin-bottom: 25px;
}

.variant-option {
  margin-bottom: 15px;
}

.variant-option label {
  display: block;
  font-weight: 600;
  margin-bottom: 8px;
  color: #2c3e50;
}

.variant-select {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #ddd;
  border-radius: 8px;
  font-size: 16px;
  background: white;
  cursor: pointer;
  transition: all 0.3s ease;
}

.variant-select:focus {
  outline: none;
  border-color: #C12624;
  box-shadow: 0 0 0 3px rgba(193, 38, 36, 0.1);
}

/* Quantità */
.quantity-section {
  margin-bottom: 25px;
}

.quantity-section label {
  display: block;
  font-weight: 600;
  margin-bottom: 8px;
  color: #2c3e50;
}

.qty-controls {
  display: flex;
  align-items: center;
  width: fit-content;
  border: 2px solid #ddd;
  border-radius: 8px;
  overflow: hidden;
}

.qty-btn {
  background: white;
  border: none;
  padding: 12px 15px;
  cursor: pointer;
  font-size: 18px;
  font-weight: bold;
  color: #666;
  transition: all 0.3s ease;
}

.qty-btn:hover {
  background: #f8f9fa;
  color: #C12624;
}

.qty-input {
  border: none;
  padding: 12px 15px;
  text-align: center;
  font-size: 16px;
  font-weight: 600;
  width: 80px;
  background: white;
}

.qty-input:focus {
  outline: none;
}

/* Bottone acquisto */
.add-to-cart-btn {
  width: 100%;
  background: linear-gradient(45deg, #C12624, #A01F1D);
  color: white;
  border: none;
  padding: 18px;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 700;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 30px;
  letter-spacing: 0.5px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 6px 20px rgba(193, 38, 36, 0.3);
}

.add-to-cart-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  transition: left 0.5s;
}

.add-to-cart-btn:hover::before {
  left: 100%;
}

.add-to-cart-btn:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 8px 25px rgba(193, 38, 36, 0.4);
}

.add-to-cart-btn:disabled {
  background: #999;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* Features */
.features {
  display: grid;
  gap: 15px;
  margin-top: 30px;
}

.feature {
  display: flex;
  align-items: center;
  gap: 15px;
  background: #f8f9fa;
  padding: 20px;
  border-radius: 12px;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.feature:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(193, 38, 36, 0.1);
  border-color: #C12624;
}

.feature-icon {
  font-size: 32px;
  color: #C12624;
}

.feature strong {
  display: block;
  color: #2c3e50;
  margin-bottom: 5px;
  font-size: 14px;
}

.feature small {
  color: #666;
  font-size: 12px;
  line-height: 1.4;
}

/* Descrizione orizzontale */
.description-horizontal {
  background: white;
  margin: 0 auto 40px auto;
  max-width: 1200px;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  overflow: hidden;
}

.description-content {
  padding: 40px;
}

.description-content h3 {
  font-size: 24px;
  font-weight: 600;
  color: #2c3e50;
  margin-bottom: 20px;
  border-bottom: 2px solid #C12624;
  padding-bottom: 12px;
  display: inline-block;
}

.description-content p {
  color: #555;
  line-height: 1.7;
  margin-bottom: 15px;
  font-size: 16px;
}

.description-content ul {
  color: #555;
  padding-left: 20px;
  margin-bottom: 15px;
}

.description-content li {
  margin-bottom: 10px;
  line-height: 1.6;
}

.description-content li::marker {
  color: #C12624;
}

/* Responsive */
@media (max-width: 768px) {
  .product-grid {
    grid-template-columns: 1fr;
    gap: 0;
    margin: 0 20px 40px 20px;
  }
  
  .product-images {
    padding: 40px 20px;
    min-height: 50vh;
  }
  
  .product-info {
    padding: 40px 20px;
    min-height: auto;
  }
  
  .breadcrumb {
    padding: 0 40px;
  }
  
  .product-title {
    font-size: 24px;
  }
  
  .current-price {
    font-size: 28px;
  }
  
  .original-price {
    font-size: 20px;
  }
  
  .description-horizontal {
    margin: 0 20px 40px 20px;
  }
  
  .description-content {
    padding: 30px 20px;
  }
  
  .description-content h3 {
    font-size: 20px;
  }
  
  .description-content p {
    font-size: 14px;
  }
}
</style>

<script>
// Varianti prodotto
var productVariants = [
  {% for variant in product.variants %}
  {
    id: {{ variant.id }},
    price: {{ variant.price }},
    compare_at_price: {{ variant.compare_at_price | default: 0 }},
    available: {{ variant.available | json }},
    options: [
      {% for option in variant.options %}"{{ option }}"{% unless forloop.last %},{% endunless %}{% endfor %}
    ]
  }{% unless forloop.last %},{% endunless %}
  {% endfor %}
];

// Cambia immagine principale
function changeMainImage(src, element) {
  document.getElementById('MainImage').src = src;
  
  // Aggiorna thumbnail attivo
  document.querySelectorAll('.thumb').forEach(function(thumb) {
    thumb.classList.remove('active');
  });
  element.classList.add('active');
}

// Aggiorna quantità
function updateQty(change) {
  var input = document.getElementById('Quantity');
  var currentValue = parseInt(input.value);
  var newValue = currentValue + change;
  
  if (newValue >= 1) {
    input.value = newValue;
  }
}

// Gestione varianti
document.addEventListener('DOMContentLoaded', function() {
  var selects = document.querySelectorAll('.variant-select');
  
  selects.forEach(function(select) {
    select.addEventListener('change', function() {
      updateVariant();
    });
  });
  
  // Gestione form
  var form = document.getElementById('product-form');
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      
      var formData = new FormData(this);
      var button = form.querySelector('.add-to-cart-btn');
      var originalText = button.textContent;
      
      button.textContent = 'Wird hinzugefügt...';
      button.disabled = true;
      
      fetch('/cart/add.js', {
        method: 'POST',
        body: formData
      })
      .then(function(response) {
        return response.json();
      })
      .then(function(data) {
        button.textContent = 'Hinzugefügt!';
        button.style.background = '#28a745';
        
        setTimeout(function() {
          button.textContent = originalText;
          button.style.background = '';
          button.disabled = false;
        }, 2000);
      })
      .catch(function(error) {
        console.error('Fehler:', error);
        button.textContent = 'Fehler - Erneut versuchen';
        
        setTimeout(function() {
          button.textContent = originalText;
          button.disabled = false;
        }, 2000);
      });
    });
  }
});

function updateVariant() {
  var selectedOptions = [];
  var selects = document.querySelectorAll('.variant-select');
  
  selects.forEach(function(select) {
    selectedOptions.push(select.value);
  });
  
  var matchingVariant = productVariants.find(function(variant) {
    return variant.options.every(function(option, index) {
      return option === selectedOptions[index];
    });
  });
  
  if (matchingVariant) {
    // Aggiorna prezzo
    var currentPrice = document.querySelector('.current-price');
    if (currentPrice) {
      currentPrice.textContent = formatMoney(matchingVariant.price);
    }
    
    // Aggiorna ID variante
    var variantSelect = document.getElementById('ProductSelect');
    if (variantSelect) {
      variantSelect.value = matchingVariant.id;
    }
    
    // Aggiorna disponibilità
    var button = document.querySelector('.add-to-cart-btn');
    if (button) {
      if (matchingVariant.available) {
        button.disabled = false;
        button.textContent = 'In den Warenkorb';
      } else {
        button.disabled = true;
        button.textContent = 'Ausverkauft';
      }
    }
  }
}

function formatMoney(cents) {
  return new Intl.NumberFormat('de-DE', {
    style: 'currency',
    currency: 'EUR'
  }).format(cents / 100);
}
</script>

{% schema %}
{
  "name": "Produkt Sektion",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_breadcrumb",
      "label": "Breadcrumb anzeigen",
      "default": true
    },
    {
      "type": "number",
      "id": "review_count",
      "label": "Anzahl Bewertungen",
      "default": 127,
      "info": "Anzahl der Bewertungen, die im Rating-Bereich angezeigt werden"
    }
  ],
  "presets": [
    {
      "name": "Produkt Sektion"
    }
  ]
}
{% endschema %}